Пакеты и фреймы — это небольшие фрагменты данных, которые, объединяясь, образуют более крупный фрагмент информации или сообщение. Однако в модели OSI это два разных понятия.
**Пакет** (packet) — это фрагмент данных с третьего уровня (сетевого уровня)  [[Изучение OSI Model#Третий уровень - Network]]модели OSI, содержащий такую информацию, как IP-заголовок (IP header) и полезная нагрузка. **Фрейм**, однако, используется на втором уровне (канальном уровне)[[Изучение OSI Model#**Второй уровень - Data link**]] модели OSI, который инкапсулирует (encapsulates) пакет и добавляет дополнительную информацию, например MAC-адреса.

Этот процесс можно сравнить с отправкой письма по почте. Конверт — это frame, которая используется для перемещения содержимого (в данной аналогии — пакета) конверта в другое место. Как только получатель откроет конверт (frame), он узнает, как переслать само письмо (пакет).

Этот процесс называется инкапсуляцией, о которой мы говорили в [комнате 3: модель OSI](https://tryhackme.com/room/osimodelzi). На данном этапе можно с уверенностью предположить, что, когда мы говорим об IP-адресах, мы имеем в виду пакеты. Когда инкапсулирующая информация удаляется, мы говорим о самом кадре.

Пакеты — это эффективный способ передачи данных между сетевыми устройствами, такими как те, что описаны в задании 1. Поскольку данные передаются небольшими фрагментами, вероятность возникновения узких мест в сети ниже, чем при одновременной отправке больших сообщений.

Например, при загрузке изображения с веб-сайта оно отправляется на ваш компьютер не целиком, а в виде небольших фрагментов, которые затем восстанавливаются на вашем компьютере.

Пакеты имеют разную структуру в зависимости от типа отправляемого пакета. Как мы увидим далее, в сетевых технологиях используется множество стандартов и протоколов, которые представляют собой набор правил обработки пакетов на устройстве. При миллиардах устройств, подключённых к интернету, без стандартизации всё может быстро выйти из строя.

Давайте продолжим наш пример с интернет-протоколом. Пакет, использующий этот протокол, будет иметь набор заголовков, содержащих дополнительную информацию о данных, отправляемых по сети.

Некоторые известные заголовки включают:

| **Заголовок**                          | **Описание**                                                                                                                                                                                     |
| -------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Время жить -  Time to Live             | В этом поле устанавливается таймер истечения срока действия пакета, чтобы он не засорял вашу сеть, если ему не удастся дойти до хоста или выйти из сети!                                         |
| Контрольная сумма - Checksum           | Это поле обеспечивает проверку целостности таких протоколов, как TCP/IP. Если какие-либо данные были изменены, это значение будет отличаться от ожидаемого и, следовательно, будет повреждённым. |
| Адрес источника - Source Address       | IP-адрес устройства, с которого отправляется пакет **от** , чтобы данные знали, куда **вернуться**.                                                                                              |
| Адрес назначения - Destination Address | IP-адрес устройства, на которое отправляется пакет данных, чтобы данные знали, куда двигаться дальше.                                                                                            |
# **TCP/IP**
Протокол TCP/IP состоит из четырёх уровней и, по сути, является упрощённой версией модели OSI. Вот эти уровни:

- Применение  application
- Транспорт transport
- Интернет internet
- Сетевой интерфейс network

По аналогии с моделью OSI информация добавляется на каждом уровне модели TCP по мере прохождения данных (или пакетов) через него. Как вы, возможно, помните, этот процесс называется инкапсуляцией, а обратный процесс — декапсуляцией.
Одной из определяющих особенностей TCP является то, что он **основан на соединении**, то есть TCP должен установить соединение между клиентом и устройством, выступающим в роли сервера **прежде** чем будут отправлены данные.
Благодаря этому TCP гарантирует, что любые отправленные данные будут получены на другом конце. Этот процесс называется трёхэтапным рукопожатием, о котором мы вскоре поговорим. Таблица, в которой сравниваются преимущества и недостатки TCP, приведена ниже:

| **Преимущества TCP**                                                                                                   | **Недостатки TCP**                                                                                                                                                                          |
| ---------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Гарантирует целостность данных.                                                                                        | Требуется надёжное соединение между двумя устройствами. Если не получен один небольшой фрагмент данных, то весь фрагмент данных не может быть использован и должен быть отправлен повторно. |
| Способен синхронизировать два устройства, чтобы предотвратить перегрузку одного из них данными в неправильном порядке. | Медленное соединение может стать узким местом для другого устройства, поскольку соединение будет постоянно зарезервировано за другим устройством.                                           |
| Обеспечивает гораздо более высокий уровень надёжности                                                                  | TCP значительно медленнее, чем UDP, поскольку устройствам, использующим этот протокол, приходится выполнять больше работы (вычислений).                                                     |

TCP-пакеты содержат различные информационные блоки, известные как заголовки, которые добавляются при инкапсуляции. Давайте рассмотрим некоторые важные заголовки в таблице ниже:


| Заголовок           | Header                 | Описание                                                                                                                                                                                                                                                             |
| ------------------- | ---------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Порт источника      | Source port            | Это значение — порт, открытый отправителем для отправки TCP-пакета. Это значение выбирается случайным образом (из портов от 0 до 65535, которые в данный момент не используются).                                                                                    |
| Порт назначения     | Destination port       | Это значение представляет собой номер порта, на котором работает приложение или служба на удалённом хосте (принимающем данные). Например, веб-сервер работает на порту 80. В отличие от исходного порта, это значение не выбирается случайным образом.               |
| IP-адрес источника  | Source IP              | Это IP-адрес устройства, с которого отправляется пакет данных.                                                                                                                                                                                                       |
| IP-адрес назначения | Destination IP         | Это IP-адрес устройства, которому предназначен пакет данных.                                                                                                                                                                                                         |
| Порядковый номер    | Sequence Number        | При установлении соединения первым передаваемым фрагментом данных является случайное число. Мы расскажем об этом подробнее далее.                                                                                                                                    |
| Номер подтверждения | Acknowlengement Number | После того как элементу данных будет присвоен порядковый номер, номер следующего элемента данных будет равен порядковому номеру + 1. Далее мы объясним это более подробно.                                                                                           |
| Контрольная сумма   | Checksum               | Именно это значение обеспечивает целостность TCP. Выполняется математическое вычисление, результат которого запоминается. Если при выполнении математического вычисления на принимающем устройстве результат отличается от отправленного, значит, данные повреждены. |
| Данные              | Data                   | В этом заголовке хранятся данные, то есть байты передаваемого файла.                                                                                                                                                                                                 |
| Флаг                | Flag                   | Этот заголовок определяет, как устройство должно обрабатывать пакет в процессе установления соединения. Конкретные флаги определяют конкретное поведение, о котором мы расскажем ниже.                                                                               |

Далее мы обсудим _трёхстороннее рукопожатие —_ термин, обозначающий процесс установления соединения между двумя устройствами. Трёхстороннее рукопожатие осуществляется с помощью нескольких специальных сообщений. В таблице ниже приведены основные из них:

  

|         |               |                                                                                                                                                                                                                                        |
| ------- | ------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Шаг** | **Сообщение** | **Описание**                                                                                                                                                                                                                           |
| 1       | SYN           | SYN-сообщение — это начальный пакет, отправляемый клиентом во время установления соединения. Этот пакет используется для установления соединения и синхронизации двух устройств (подробнее об этом мы расскажем позже).                |
| 2       | SYN/ACK       | Этот пакет отправляется принимающим устройством (сервером) для подтверждения попытки синхронизации со стороны клиента.                                                                                                                 |
| 3       | ACK           | Пакет подтверждения может использоваться как клиентом, так и сервером для подтверждения успешного получения серии сообщений/пакетов.                                                                                                   |
| 4       | DATA          | После установления соединения данные (например, байты файла) отправляются с помощью сообщения DATA.                                                                                                                                    |
| 5       | FIN           | Этот пакет используется для _корректного (надлежащего)_ закрытия соединения после его завершения.                                                                                                                                      |
| #       | RST           | Этот пакет данных резко обрывает все соединения. Это крайняя мера, которая указывает на наличие проблемы в процессе. Например, если служба или приложение работают некорректно или в системе есть ошибки, такие как нехватка ресурсов. |

Всем отправляемым данным присваивается случайная последовательность чисел, которая используется для их восстановления с увеличением на 1. Для отправки данных в правильном порядке оба компьютера должны использовать одну и ту же последовательность чисел. Эта последовательность согласовывается в три этапа:

1. SYN — клиент: вот мой начальный порядковый номер (ISN) для SYNхронизации (0)
2. SYN/ACK — сервер: вот мой начальный порядковый номер (ISN) для SYNхронизации (5000), и я ACKподтверждаю ваш начальный порядковый номер (0)
3. ACK — клиент: я ACKподтверждаю ваш начальный порядковый номер (ISN) (5000), вот некоторые данные, которые являются моим ISN+1 (0 + 1)
**TCP Закрытие соединения:**

Давайте вкратце объясним процесс закрытия соединения TCP. Во-первых, TCP закрывает соединение, как только устройство определяет, что другое устройство успешно получило все данные.

Поскольку TCP резервирует системные ресурсы на устройстве, рекомендуется как можно скорее закрывать TCP-соединения.

Чтобы инициировать закрытие TCP-соединения, устройство отправит другому устройству пакет «FIN». Конечно, при использовании TCP другое устройство также должно подтвердить получение этого пакета.

# **UPD/IP**
Протокол **U**ser **D**atagram **P**rotocol (**UDP**) — это ещё один протокол, который используется для передачи данных между устройствами.

  

В отличие от своего собрата TCP, UDP — это **протокол без сохранения состояния** протокол, который не требует постоянного соединения между двумя устройствами для отправки данных. Например, не происходит трёхэтапного подтверждения, а также отсутствует синхронизация между двумя устройствами.

  

Вспомним некоторые сравнения этих двух протоколов в разделе 3 «Модель OSI». В частности, UDP используется в ситуациях, когда приложения могут допускать потерю данных (например, при потоковой передаче видео или голосовом чате), или в случаях, когда нестабильное соединение не является критичным. Таблица, в которой сравниваются преимущества и недостатки UDP, приведена ниже:

| **Преимущества UDP**                                                                                                                            | **Недостатки UDP**                                                                 |
| ----------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------- |
| UDP работает намного быстрее, чем TCP.                                                                                                          | UDP не заботится о том, получены данные или нет.                                   |
| UDP позволяет приложению (пользовательскому программному обеспечению) самостоятельно решать, можно ли контролировать скорость отправки пакетов. | В этом смысле он довольно гибок для разработчиков программного обеспечения.        |
| UDP не резервирует постоянное соединение на устройстве, как это делает TCP.                                                                     | Это означает, что нестабильное соединение доставляет пользователю массу неудобств. |

Как уже упоминалось, при установлении соединения между двумя устройствами не происходит никаких процессов. Это означает, что не учитывается, получены ли данные, и не применяются меры безопасности, такие как целостность данных, предлагаемые TCP.

UDP-пакеты намного проще TCP-пакетов и содержат меньше заголовков. Однако оба протокола используют некоторые стандартные заголовки, которые указаны в таблице ниже:

| **Заголовок**                          | **Описание**                                                                                                                                                                                                                                                |
| -------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Время жизни (TTL)                      | В этом поле устанавливается таймер истечения срока действия пакета, чтобы он не засорял вашу сеть, если ему не удастся дойти до хоста или выйти из сети!                                                                                                    |
| Адрес источника (Source Address)       | IP-адрес устройства, с которого отправляется пакет данных, чтобы данные знали, куда возвращаться.                                                                                                                                                           |
| Адрес назначения (Destination Address) | IP-адрес устройства, на которое отправляется пакет данных, чтобы система знала, куда направлять данные дальше.                                                                                                                                              |
| Порт источника (Source Port)           | Это значение — порт, который открывает отправитель для отправки UDP-пакета. Это значение выбирается случайным образом (из портов от 0 до 65535, которые в данный момент не используются).                                                                   |
| Порт назначения (Destination Port)     | Это значение представляет собой номер порта, на котором работает приложение или служба на удалённом хосте (который получает данные). Например, веб-сервер работает на порту 80. В отличие от исходного порта, это значение не выбирается случайным образом. |
| Данные (Data)                          | В этом заголовке хранятся данные, то есть байты передаваемого файла.                                                                                                                                                                                        |

Далее мы рассмотрим, чем процесс установления соединения через UDP отличается от процесса установления соединения через TCP. Следует помнить, что UDP **не сохраняет состояние**. Во время установления соединения подтверждение не отправляется.

Какой тип соединения используется в UDP? Stateless - протокол без сохранения состояния